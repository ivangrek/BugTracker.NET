@*
    Copyright 2002-2011 Corey Trager
    Copyright 2017-2019 Ivan Grek

    Distributed under the terms of the GNU General Public License
*@

@model BugTracker.Web.Models.SortableTableModel

@{
    var page = (BugTracker.Web.Models.PageModel)ViewBag.Page;

    ViewBag.Title = page.Title;
}

@section Styles {
}

@section Scripts {
    <script type="text/javascript" src="~/Scripts/sortable.js"></script>
}

@section BodyHeader {
    @Html.Partial("~/Areas/Administration/Views/Shared/_MainMenu.cshtml", page)
}

@section BodySubHeader {
    <div class="nav-scroller bg-light border-bottom">
        <nav class="nav nav-underline">
            <a href="@Url.Action("Create", "Query")" class="nav-link"><img src="~/Content/images/add.png" align="top">&nbsp;New</a>
        </nav>
    </div>
}

@if (page.Security.User.IsAdmin || page.Security.User.CanEditSql)
{
    <div class="row px-3 mb-3">
        @{
            var formId = Guid.NewGuid().ToString();
            var code = "document.getElementById('" + formId + "').submit();";
        }

        @using (Html.BeginForm("Index", "Query", FormMethod.Get, new { id = formId, @class = "form-inline ml-auto" }))
        {
            <div class="form-check mb-2 mr-sm-2">
                @Html.CheckBox("ShowAll", (bool)ViewBag.ShowAll, new { @class = "form-check-input",  onchange = code })
                @Html.Label("ShowAll", "show everybody's private queries:", new { @class = "form-check-label" })
            </div>
        }
    </div>
}
else
{
}

@if (Model.DataTable.Rows.Count > 0)
{
    @Html.Partial("_SortableTable", Model);
}
else
{
    <div>No queries in the database.</div>
}

@section BodyFooter {
    @Html.Raw(BugTracker.Web.Core.Util.Context.Application["custom_footer"])
}
